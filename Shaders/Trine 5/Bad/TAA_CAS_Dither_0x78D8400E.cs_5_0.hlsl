Texture2D<unorm float4> t3 : register(t3); // Film grain / noise / dither
Texture2D<unorm float> t2 : register(t2); // Depth?
Texture2D<snorm float2> t1 : register(t1); // Motion Vectors?
#if 1 // LUMA
Texture2D<float4> t0 : register(t0); // Source color (HDR)
RWTexture2D<float4> u0 : register(u0); // Output
#else
Texture2D<unorm float4> t0 : register(t0); // Source color (SDR)
RWTexture2D<unorm float4> u0 : register(u0); // Output
#endif

cbuffer cb0 : register(b0)
{
  float4 cb0[5];
}

#define cmp -

[numthreads(64, 1, 1)]
void main(uint3 vThreadGroupID : SV_GroupThreadID, uint3 vThreadIDInGroup : SV_GroupID)
{
  asd; // Break compilation
#if 0
  u0[vThreadID.xy] = t0.Load(vThreadID.xyz);
#else
  float4 r0,r1,r2,r3,r4,r5,r6,r7;
  uint4 bitmask;

  r0.yw = float2(0,0);
  r1.x = (uint)vThreadIDInGroup.x >> 3;
  bitmask.y = ((~(-1 << 1)) << 0) & 0xffffffff;  r1.y = (((uint)vThreadIDInGroup.x << 0) & bitmask.y) | ((uint)r1.x & ~bitmask.y);
  if (3 == 0) r1.x = 0; else if (3+1 < 32) {   r1.x = (uint)vThreadIDInGroup.x << (32-(3 + 1)); r1.x = (uint)r1.x >> (32-3);  } else r1.x = (uint)vThreadIDInGroup.x >> 1;
  r0.xz = mad((int2)vThreadGroupID.xy, int2(16,16), (int2)r1.xy);
  r1.x = t2.Load(r0.xzw).x;
  r1.yz = t1.Load(r0.xzy).xy;
  r1.w = -r1.y * 0.5 + r1.x;
  r2.yw = r1.zy * float2(0.5,0.5) + r1.xx;
  r2.z = -r1.z * 0.5 + r1.w;
  r2.x = -r1.z * 0.5 + r2.w;
  r2.xyz = saturate(r2.xyz);
  r1.xyzw = (int4)r0.xzxz + int4(0,1,1,0);
  r3.xy = r1.zw;
  r3.zw = float2(0,0);
  r2.w = t2.Load(r3.xyw).x;
  r3.xy = t1.Load(r3.xyz).xy;
  r3.z = -r3.x * 0.5 + r2.w;
  r4.yw = r3.yx * float2(0.5,0.5) + r2.ww;
  r4.z = -r3.y * 0.5 + r3.z;
  r4.x = -r3.y * 0.5 + r4.w;
  r4.xyz = saturate(r4.xyz);
  r2.w = min(r4.y, r2.y);
  r3.xyzw = (int4)r0.xzxz + int4(0,-1,-1,0);
  r5.xy = r3.zw;
  r5.zw = float2(0,0);
  r4.w = t2.Load(r5.xyw).x;
  r5.xy = t1.Load(r5.xyz).xy;
  r5.z = -r5.x * 0.5 + r4.w;
  r6.yw = r5.yx * float2(0.5,0.5) + r4.ww;
  r6.z = -r5.y * 0.5 + r5.z;
  r6.x = -r5.y * 0.5 + r6.w;
  r6.xyz = saturate(r6.xyz);
  r2.w = min(r6.y, r2.w);
  r3.zw = float2(0,0);
  r4.w = t2.Load(r3.xyw).x;
  r3.xy = t1.Load(r3.xyz).xy;
  r3.z = -r3.x * 0.5 + r4.w;
  r5.yw = r3.yx * float2(0.5,0.5) + r4.ww;
  r5.z = -r3.y * 0.5 + r3.z;
  r5.x = -r3.y * 0.5 + r5.w;
  r5.xyz = saturate(r5.xyz);
  r1.zw = float2(0,0);
  r3.x = t2.Load(r1.xyw).x;
  r1.xy = t1.Load(r1.xyz).xy;
  r1.z = -r1.x * 0.5 + r3.x;
  r3.yw = r1.yx * float2(0.5,0.5) + r3.xx;
  r3.z = -r1.y * 0.5 + r1.z;
  r3.x = -r1.y * 0.5 + r3.w;
  r3.xyz = saturate(r3.xyz);
  r1.x = min(r5.y, r3.y);
  r1.x = min(r2.w, r1.x);
  r1.y = max(r4.y, r2.y);
  r1.y = max(r6.y, r1.y);
  r1.z = max(r5.y, r3.y);
  r1.y = max(r1.y, r1.z);
  r1.z = 1 + -r1.y;
  r1.y = (int)-r1.y + 0x7ef07ebb;
  r1.x = min(r1.x, r1.z);
  r1.x = saturate(r1.x * r1.y);
  r1.x = (uint)r1.x >> 1;
  r1.x = (int)r1.x + 0x1fbc4639;
  r1.x = cb0[4].x * r1.x;
  r1.yzw = r6.xyz * r1.xxx;
  r1.yzw = r5.xyz * r1.xxx + r1.yzw;
  r1.yzw = r4.xyz * r1.xxx + r1.yzw;
  r1.yzw = r3.xyz * r1.xxx + r1.yzw;
  r1.x = r1.x * 4 + 1;
  r1.yzw = r1.yzw + r2.xyz;
  r2.x = (int)-r1.x + 0x7ef19fff;
  r1.x = -r2.x * r1.x + 2;
  r1.x = r2.x * r1.x;
  r1.xyz = saturate(r1.yzw * r1.xxx);
  r2.xyz = log2(r1.xyz);
  r2.xyz = float3(0.416666657,0.416666657,0.416666657) * r2.xyz;
  r2.xyz = exp2(r2.xyz);
  r2.xyz = r2.xyz * float3(1.05499995,1.05499995,1.05499995) + float3(-0.0549999997,-0.0549999997,-0.0549999997);
  r3.xyz = r1.xyz * float3(12.9200001,12.9200001,12.9200001) + -r2.xyz;
  r1.xyz = cmp(float3(0.00313080009,0.00313080009,0.00313080009) >= r1.xyz);
  r1.xyz = r1.xyz ? float3(1,1,1) : 0;
  r1.xyz = r1.xyz * r3.xyz + r2.xyz;
  r2.xy = (int2)r0.xz + asint(cb0[1].zw);
  r2.xy = (int2)r2.xy & int2(63,63);
  r2.zw = float2(0,0);
  r2.xyz = t3.Load(r2.xyz).xyz;
  r2.xyz = r2.xyz * float3(2,2,2) + float3(-1,-1,-1);
  r3.xyz = cmp(float3(0,0,0) < r2.xyz);
  r4.xyz = cmp(r2.xyz < float3(0,0,0));
  r2.xyz = float3(1,1,1) + -abs(r2.xyz);
  r2.xyz = sqrt(r2.xyz);
  r2.xyz = float3(1,1,1) + -r2.xyz;
  r3.xyz = (int3)-r3.xyz + (int3)r4.xyz;
  r3.xyz = (int3)r3.xyz;
  r2.xyz = r3.xyz * r2.xyz;
  r1.xyz = r2.xyz * float3(0.00787401572,0.00787401572,0.00787401572) + r1.xyz;
  r1.w = 1;
  r2.xyzw = (int4)r0.xzzz + asint(cb0[2].xyyy);
  u0[r2.xy] = r1.xyzw;
  r1.zw = float2(0,0);
  r0.xy = (int2)r0.xz + int2(8,8);
  r1.xy = (int2)r0.xz + int2(1,0);
  r2.x = t2.Load(r1.xyw).x;
  r1.xy = t1.Load(r1.xyz).xy;
  r1.z = -r1.x * 0.5 + r2.x;
  r2.yw = r1.yx * float2(0.5,0.5) + r2.xx;
  r2.z = -r1.y * 0.5 + r1.z;
  r2.x = -r1.y * 0.5 + r2.w;
  r2.xyz = saturate(r2.xyz);
  r0.w = 0;
  r1.x = t2.Load(r0.xzw).x;
  r1.yz = t1.Load(r0.xzw).xy;
  r1.w = -r1.y * 0.5 + r1.x;
  r3.yw = r1.zy * float2(0.5,0.5) + r1.xx;
  r3.z = -r1.z * 0.5 + r1.w;
  r3.x = -r1.z * 0.5 + r3.w;
  r3.xyz = saturate(r3.xyz);
  r1.x = min(r3.y, r2.y);
  r4.zw = float2(0,0);
  r4.xy = (int2)r0.xz + int2(-1,0);
  r1.y = t2.Load(r4.xyw).x;
  r1.zw = t1.Load(r4.xyz).xy;
  r2.w = -r1.z * 0.5 + r1.y;
  r4.yw = r1.wz * float2(0.5,0.5) + r1.yy;
  r4.z = -r1.w * 0.5 + r2.w;
  r4.x = -r1.w * 0.5 + r4.w;
  r4.xyz = saturate(r4.xyz);
  r1.x = min(r4.y, r1.x);
  r5.zw = float2(0,0);
  r5.xy = (int2)r0.xz + int2(0,-1);
  r1.y = t2.Load(r5.xyw).x;
  r1.zw = t1.Load(r5.xyz).xy;
  r2.w = -r1.z * 0.5 + r1.y;
  r5.yw = r1.wz * float2(0.5,0.5) + r1.yy;
  r5.z = -r1.w * 0.5 + r2.w;
  r5.x = -r1.w * 0.5 + r5.w;
  r5.xyz = saturate(r5.xyz);
  r6.zw = float2(0,0);
  r6.xy = (int2)r0.xz + int2(0,1);
  r1.y = t2.Load(r6.xyw).x;
  r1.zw = t1.Load(r6.xyz).xy;
  r2.w = -r1.z * 0.5 + r1.y;
  r6.yw = r1.wz * float2(0.5,0.5) + r1.yy;
  r6.z = -r1.w * 0.5 + r2.w;
  r6.x = -r1.w * 0.5 + r6.w;
  r6.xyz = saturate(r6.xyz);
  r1.y = min(r6.y, r5.y);
  r1.x = min(r1.x, r1.y);
  r1.y = max(r3.y, r2.y);
  r1.y = max(r4.y, r1.y);
  r1.z = max(r6.y, r5.y);
  r1.y = max(r1.y, r1.z);
  r1.z = 1 + -r1.y;
  r1.y = (int)-r1.y + 0x7ef07ebb;
  r1.x = min(r1.x, r1.z);
  r1.x = saturate(r1.x * r1.y);
  r1.x = (uint)r1.x >> 1;
  r1.x = (int)r1.x + 0x1fbc4639;
  r1.x = cb0[4].x * r1.x;
  r1.yzw = r4.xyz * r1.xxx;
  r1.yzw = r5.xyz * r1.xxx + r1.yzw;
  r1.yzw = r2.xyz * r1.xxx + r1.yzw;
  r1.yzw = r6.xyz * r1.xxx + r1.yzw;
  r1.x = r1.x * 4 + 1;
  r1.yzw = r1.yzw + r3.xyz;
  r2.x = (int)-r1.x + 0x7ef19fff;
  r1.x = -r2.x * r1.x + 2;
  r1.x = r2.x * r1.x;
  r1.xyz = saturate(r1.yzw * r1.xxx);
  r2.xyz = log2(r1.xyz);
  r2.xyz = float3(0.416666657,0.416666657,0.416666657) * r2.xyz;
  r2.xyz = exp2(r2.xyz);
  r2.xyz = r2.xyz * float3(1.05499995,1.05499995,1.05499995) + float3(-0.0549999997,-0.0549999997,-0.0549999997);
  r3.xyz = r1.xyz * float3(12.9200001,12.9200001,12.9200001) + -r2.xyz;
  r1.xyz = cmp(float3(0.00313080009,0.00313080009,0.00313080009) >= r1.xyz);
  r1.xyz = r1.xyz ? float3(1,1,1) : 0;
  r1.xyz = r1.xyz * r3.xyz + r2.xyz;
  r2.zw = float2(0,0);
  r3.xyzw = (int4)r0.xzxy + asint(cb0[1].zwzw);
  r4.xyzw = (int4)r0.xzzz + asint(cb0[2].xyyy);
  r2.xy = (int2)r3.xy & int2(63,63);
  r3.xy = (int2)r3.zw & int2(63,63);
  r2.xyz = t3.Load(r2.xyz).xyz;
  r2.xyz = r2.xyz * float3(2,2,2) + float3(-1,-1,-1);
  r5.xyz = cmp(float3(0,0,0) < r2.xyz);
  r6.xyz = cmp(r2.xyz < float3(0,0,0));
  r2.xyz = float3(1,1,1) + -abs(r2.xyz);
  r2.xyz = sqrt(r2.xyz);
  r2.xyz = float3(1,1,1) + -r2.xyz;
  r5.xyz = (int3)-r5.xyz + (int3)r6.xyz;
  r5.xyz = (int3)r5.xyz;
  r2.xyz = r5.xyz * r2.xyz;
  r1.xyz = r2.xyz * float3(0.00787401572,0.00787401572,0.00787401572) + r1.xyz;
  r1.w = 1;
  u0[r4.xy] = r1.xyzw;
  r0.z = t2.Load(r0.xyw).x;
  r1.xy = t1.Load(r0.xyw).xy;
  r0.w = -r1.x * 0.5 + r0.z;
  r2.yw = r1.yx * float2(0.5,0.5) + r0.zz;
  r2.z = -r1.y * 0.5 + r0.w;
  r2.x = -r1.y * 0.5 + r2.w;
  r2.xyz = saturate(r2.xyz);
  r1.xyzw = (int4)r0.xyxy + int4(0,1,1,0);
  r4.xy = r1.zw;
  r4.zw = float2(0,0);
  r0.z = t2.Load(r4.xyw).x;
  r4.xy = t1.Load(r4.xyz).xy;
  r0.w = -r4.x * 0.5 + r0.z;
  r5.yw = r4.yx * float2(0.5,0.5) + r0.zz;
  r5.z = -r4.y * 0.5 + r0.w;
  r5.x = -r4.y * 0.5 + r5.w;
  r5.xyz = saturate(r5.xyz);
  r0.z = min(r5.y, r2.y);
  r4.xyzw = (int4)r0.xyxy + int4(0,-1,-1,0);
  r6.xy = r4.zw;
  r6.zw = float2(0,0);
  r0.w = t2.Load(r6.xyw).x;
  r6.xy = t1.Load(r6.xyz).xy;
  r2.w = -r6.x * 0.5 + r0.w;
  r7.yw = r6.yx * float2(0.5,0.5) + r0.ww;
  r7.z = -r6.y * 0.5 + r2.w;
  r7.x = -r6.y * 0.5 + r7.w;
  r7.xyz = saturate(r7.xyz);
  r0.z = min(r7.y, r0.z);
  r4.zw = float2(0,0);
  r0.w = t2.Load(r4.xyw).x;
  r4.xy = t1.Load(r4.xyz).xy;
  r2.w = -r4.x * 0.5 + r0.w;
  r6.yw = r4.yx * float2(0.5,0.5) + r0.ww;
  r6.z = -r4.y * 0.5 + r2.w;
  r6.x = -r4.y * 0.5 + r6.w;
  r6.xyz = saturate(r6.xyz);
  r1.zw = float2(0,0);
  r0.w = t2.Load(r1.xyw).x;
  r1.xy = t1.Load(r1.xyz).xy;
  r1.z = -r1.x * 0.5 + r0.w;
  r4.yw = r1.yx * float2(0.5,0.5) + r0.ww;
  r4.z = -r1.y * 0.5 + r1.z;
  r4.x = -r1.y * 0.5 + r4.w;
  r4.xyz = saturate(r4.xyz);
  r0.w = min(r6.y, r4.y);
  r0.z = min(r0.z, r0.w);
  r0.w = max(r5.y, r2.y);
  r0.w = max(r7.y, r0.w);
  r1.x = max(r6.y, r4.y);
  r0.w = max(r1.x, r0.w);
  r1.x = 1 + -r0.w;
  r0.w = (int)-r0.w + 0x7ef07ebb;
  r0.z = min(r1.x, r0.z);
  r0.z = saturate(r0.z * r0.w);
  r0.z = (uint)r0.z >> 1;
  r0.z = (int)r0.z + 0x1fbc4639;
  r0.z = cb0[4].x * r0.z;
  r1.xyz = r7.xyz * r0.zzz;
  r1.xyz = r6.xyz * r0.zzz + r1.xyz;
  r1.xyz = r5.xyz * r0.zzz + r1.xyz;
  r1.xyz = r4.xyz * r0.zzz + r1.xyz;
  r0.z = r0.z * 4 + 1;
  r1.xyz = r1.xyz + r2.xyz;
  r0.w = (int)-r0.z + 0x7ef19fff;
  r0.z = -r0.w * r0.z + 2;
  r0.z = r0.w * r0.z;
  r1.xyz = saturate(r1.xyz * r0.zzz);
  r2.xyz = log2(r1.xyz);
  r2.xyz = float3(0.416666657,0.416666657,0.416666657) * r2.xyz;
  r2.xyz = exp2(r2.xyz);
  r2.xyz = r2.xyz * float3(1.05499995,1.05499995,1.05499995) + float3(-0.0549999997,-0.0549999997,-0.0549999997);
  r4.xyz = r1.xyz * float3(12.9200001,12.9200001,12.9200001) + -r2.xyz;
  r1.xyz = cmp(float3(0.00313080009,0.00313080009,0.00313080009) >= r1.xyz);
  r1.xyz = r1.xyz ? float3(1,1,1) : 0;
  r1.xyz = r1.xyz * r4.xyz + r2.xyz;
  r3.zw = float2(0,0);
  r2.xyz = t3.Load(r3.xyz).xyz;
  r2.xyz = r2.xyz * float3(2,2,2) + float3(-1,-1,-1);
  r3.xyz = cmp(float3(0,0,0) < r2.xyz);
  r4.xyz = cmp(r2.xyz < float3(0,0,0));
  r2.xyz = float3(1,1,1) + -abs(r2.xyz);
  r2.xyz = sqrt(r2.xyz);
  r2.xyz = float3(1,1,1) + -r2.xyz;
  r3.xyz = (int3)-r3.xyz + (int3)r4.xyz;
  r3.xyz = (int3)r3.xyz;
  r2.xyz = r3.xyz * r2.xyz;
  r1.xyz = r2.xyz * float3(0.00787401572,0.00787401572,0.00787401572) + r1.xyz;
  r1.w = 1;
  r2.xyzw = (int4)r0.xyyy + asint(cb0[2].xyyy);
  u0[r2.xy] = r1.xyzw;
  r1.xy = (int2)r0.xy + int2(-8,1);
  r1.zw = float2(0,0);
  r0.z = t2.Load(r1.xyw).x;
  r1.xy = t1.Load(r1.xyz).xy;
  r0.w = -r1.x * 0.5 + r0.z;
  r2.yw = r1.yx * float2(0.5,0.5) + r0.zz;
  r2.z = -r1.y * 0.5 + r0.w;
  r2.x = -r1.y * 0.5 + r2.w;
  r2.xyz = saturate(r2.xyz);
  r1.xyz = (int3)r0.xxy + int3(-8,-8,-1);
  r1.w = 0;
  r0.z = t2.Load(r1.yzw).x;
  r1.yz = t1.Load(r1.yzw).xy;
  r3.xzw = r1.xww;
  r0.w = -r1.y * 0.5 + r0.z;
  r4.yw = r1.zy * float2(0.5,0.5) + r0.zz;
  r4.z = -r1.z * 0.5 + r0.w;
  r4.x = -r1.z * 0.5 + r4.w;
  r4.xyz = saturate(r4.xyz);
  r0.z = min(r4.y, r2.y);
  r1.xyzw = (int4)r0.xyxy + int4(-9,0,-7,0);
  r3.y = r0.y;
  r5.xy = r1.zw;
  r5.zw = float2(0,0);
  r0.x = t2.Load(r5.xyw).x;
  r0.yw = t1.Load(r5.xyz).xy;
  r2.w = -r0.y * 0.5 + r0.x;
  r5.yw = r0.wy * float2(0.5,0.5) + r0.xx;
  r5.z = -r0.w * 0.5 + r2.w;
  r5.x = -r0.w * 0.5 + r5.w;
  r5.xyz = saturate(r5.xyz);
  r0.x = t2.Load(r3.xyw).x;
  r0.yw = t1.Load(r3.xyz).xy;
  r2.w = -r0.y * 0.5 + r0.x;
  r6.yw = r0.wy * float2(0.5,0.5) + r0.xx;
  r6.z = -r0.w * 0.5 + r2.w;
  r6.x = -r0.w * 0.5 + r6.w;
  r6.xyz = saturate(r6.xyz);
  r0.x = min(r6.y, r5.y);
  r1.zw = float2(0,0);
  r0.y = t2.Load(r1.xyw).x;
  r1.xy = t1.Load(r1.xyz).xy;
  r0.w = -r1.x * 0.5 + r0.y;
  r7.yw = r1.yx * float2(0.5,0.5) + r0.yy;
  r7.z = -r1.y * 0.5 + r0.w;
  r7.x = -r1.y * 0.5 + r7.w;
  r7.xyz = saturate(r7.xyz);
  r0.x = min(r7.y, r0.x);
  r0.x = min(r0.x, r0.z);
  r0.y = max(r4.y, r2.y);
  r0.z = max(r6.y, r5.y);
  r0.z = max(r7.y, r0.z);
  r0.y = max(r0.z, r0.y);
  r0.z = 1 + -r0.y;
  r0.y = (int)-r0.y + 0x7ef07ebb;
  r0.x = min(r0.x, r0.z);
  r0.x = saturate(r0.x * r0.y);
  r0.x = (uint)r0.x >> 1;
  r0.x = (int)r0.x + 0x1fbc4639;
  r0.x = cb0[4].x * r0.x;
  r0.yzw = r7.xyz * r0.xxx;
  r0.yzw = r4.xyz * r0.xxx + r0.yzw;
  r0.yzw = r5.xyz * r0.xxx + r0.yzw;
  r0.yzw = r2.xyz * r0.xxx + r0.yzw;
  r0.x = r0.x * 4 + 1;
  r0.yzw = r0.yzw + r6.xyz;
  r1.x = (int)-r0.x + 0x7ef19fff;
  r0.x = -r1.x * r0.x + 2;
  r0.x = r1.x * r0.x;
  r0.xyz = saturate(r0.yzw * r0.xxx);
  r1.xyz = log2(r0.xyz);
  r1.xyz = float3(0.416666657,0.416666657,0.416666657) * r1.xyz;
  r1.xyz = exp2(r1.xyz);
  r1.xyz = r1.xyz * float3(1.05499995,1.05499995,1.05499995) + float3(-0.0549999997,-0.0549999997,-0.0549999997);
  r2.xyz = r0.xyz * float3(12.9200001,12.9200001,12.9200001) + -r1.xyz;
  r0.xyz = cmp(float3(0.00313080009,0.00313080009,0.00313080009) >= r0.xyz);
  r0.xyz = r0.xyz ? float3(1,1,1) : 0;
  r0.xyz = r0.xyz * r2.xyz + r1.xyz;
  r1.xy = (int2)r3.xy + asint(cb0[1].zw);
  r2.xyzw = (int4)r3.xyyy + asint(cb0[2].xyyy);
  r1.xy = (int2)r1.xy & int2(63,63);
  r1.zw = float2(0,0);
  r1.xyz = t3.Load(r1.xyz).xyz;
  r1.xyz = r1.xyz * float3(2,2,2) + float3(-1,-1,-1);
  r3.xyz = cmp(float3(0,0,0) < r1.xyz);
  r4.xyz = cmp(r1.xyz < float3(0,0,0));
  r1.xyz = float3(1,1,1) + -abs(r1.xyz);
  r1.xyz = sqrt(r1.xyz);
  r1.xyz = float3(1,1,1) + -r1.xyz;
  r3.xyz = (int3)-r3.xyz + (int3)r4.xyz;
  r3.xyz = (int3)r3.xyz;
  r1.xyz = r3.xyz * r1.xyz;
  r0.xyz = r1.xyz * float3(0.00787401572,0.00787401572,0.00787401572) + r0.xyz;
  r0.w = 1;
  u0[r2.xy] = r0.xyzw;
#endif
}